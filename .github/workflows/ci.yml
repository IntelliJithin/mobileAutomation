name: Mobile Automation Test on BrowserStack
 
on:
  workflow_dispatch:
 
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout Code
        uses: actions/checkout@v4
 
      - name: üê¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
 
      - name: üì¶ Cache Node Modules
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-
 
      - name: üèóÔ∏è Install Dependencies
        run: npm install
 
      - name: üîß Install Appium & WebDriverIO Dependencies
        run: |
          npm install -g appium
          appium driver install uiautomator2
 
      - name: üîë Set Up BrowserStack Environment Variables
        run: |
          echo "BROWSERSTACK_USERNAME=${{ secrets.BROWSERSTACK_USERNAME }}" >> $GITHUB_ENV
          echo "BROWSERSTACK_ACCESS_KEY=${{ secrets.BROWSERSTACK_ACCESS_KEY }}" >> $GITHUB_ENV
 
      - name: üèÅ Run Tests on BrowserStack
        env:
          BROWSERSTACK_USERNAME: ${{ secrets.BROWSERSTACK_USERNAME }}
          BROWSERSTACK_ACCESS_KEY: ${{ secrets.BROWSERSTACK_ACCESS_KEY }}
        run: npx wdio wdio.browserstack.conf.js