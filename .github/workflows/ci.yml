name: Mobile automation test
on:
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
        - name: ⬇️ Checkout Code
          uses: actions/checkout@v4

        - name: 🐢 Setup Node
          uses: actions/setup-node@v4
          with:
            node-version: 18

        - name: Clean node_modules and package-lock.json
          run:
            rm -rf node_modules
            rm package-lock.json
            npm install # Reinstall dependencies cleanly

        - name: 🏗️ Install Dependencies
          run: npm install

        - name: Install Appium and drivers
          run: 
            npm install -g appium
            npm install appium-uiautomator2-driver
            appium driver install uiautomator2

        - name: List installed Appium drivers
          run: appium driver list --installed

        - name: Fix Permissions
          run: chmod +x node_modules/.bin/wdio

        - name: 🧪 Run WebdriverIO Tests
          run: npx wdio wdio.conf.js

        - name: 📦 Upload Logs
          uses: actions/upload-artifact@v4
          if: failure()
          with:
            name: logs
            path: logs
